# Example mutations for Research Paper Analysis schema

# Upsert user profile based on auth.uid
mutation UpsertUser($name: String, $email: String!) @auth(level: USER) {
  user_upsert(data: { id_expr: "auth.uid", name: $name, email: $email })
}

# Create a paper
mutation CreatePaper(
  $title: String!
  $authors: [String!]
  $year: Int
  $abstract: String
) @auth(level: USER_EMAIL_VERIFIED, insecureReason: "Verified users can add papers") {
  paper_insert(
    data: {
      title: $title
      authors: $authors
      year: $year
      abstract: $abstract
    }
  )
}

# Link a codebase to a paper
mutation LinkCodebase($paperId: UUID!, $repositoryUrl: String!) @auth(level: USER) {
  # Set the one-to-one relation using the foreign key field 'paperId'
  codebase_upsert(
    data: { paperId: $paperId, repositoryUrl: $repositoryUrl, isLinked: true }
  )
}

# Add a GitHub link extracted from paper
mutation AddCodeLink($paperId: UUID!, $url: String!) @auth(level: USER) {
  codeLink_upsert(data: { paperId: $paperId, url: $url })
}

# Create chat session
mutation CreateChatSession($title: String) @auth(level: USER) {
  chatSession_insert(data: { userId_expr: "auth.uid", title: $title })
}

# Add chat message
mutation AddChatMessage($sessionId: UUID!, $role: String!, $content: String!)
  @auth(level: USER) {
  chatMessage_insert(
    data: { sessionId: $sessionId, role: $role, content: $content }
  )
}
