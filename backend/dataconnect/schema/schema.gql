


type User @table {
  id: String! @default(expr: "auth.uid")
  name: String @col(dataType: "varchar(100)")
  email: String! @unique @col(dataType: "varchar(320)")
  createdAt: Date! @default(expr: "request.time")
}


type Paper @table {
  # Implicit id: UUID! Keep implicit for simplicity.
  title: String!
  authors: [String!] @col(dataType: "text[]")
  year: Int
  abstract: String
  citationCount: Int @default(expr: "0")
  ingestionStatus: String @col(dataType: "varchar(16)") @default(expr: "'queued'")
  createdAt: Date! @default(expr: "request.time")
}


# Codebase linked to a paper. One-to-one relationship to Paper.
type Codebase @table {
  paper: Paper @unique
  repositoryUrl: String! @unique
  isLinked: Boolean! @default(expr: "false")
  lastSyncedAt: Date
}


type FileNode @table {
  # Implicit id (UUID) added by Data Connect
  codebase: Codebase!
  parent: FileNode
  name: String!
  path: String!
  nodeType: String! @col(dataType: "varchar(16)") # 'file' or 'directory'
}

# Commits associated with a Codebase.
type Commit @table {
  codebase: Codebase!
  sha: String! @unique @col(dataType: "varchar(64)")
  message: String
  author: String @col(dataType: "varchar(200)")
  date: Date! @default(expr: "request.time")
}

# GitHub links extracted from paper text.
type CodeLink @table(name: "CodeLinks", key: ["paper", "url"]) {
  paper: Paper!
  url: String!
}

# Many-to-many join of Users and Papers they curate.
type UserPaper @table(name: "UserPapers", key: ["user", "paper"]) {
  user: User!
  paper: Paper!
}


# Chat session containing multiple messages, scoped to a user.
type ChatSession @table {
  # Implicit id: UUID!
  user: User!
  title: String @col(dataType: "varchar(200)")
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# Messages in a chat session. Role is 'user' or 'assistant'.
type ChatMessage @table {
  session: ChatSession!
  role: String! @col(dataType: "varchar(16)")
  content: String!
  createdAt: Date! @default(expr: "request.time")
}




type DiscoveredPaper @table(name: "DiscoveredPapers", key: ["source", "externalId"]) {
  source: String! @col(dataType: "varchar(16)") 
  externalId: String! @col(dataType: "varchar(128)")
  title: String!
  authors: [String!] @col(dataType: "text[]")
  year: Int
  abstract: String
  relevanceScore: Float
  matchType: String @col(dataType: "varchar(16)") # keyword | semantic | both
  query: String
  createdAt: Date! @default(expr: "request.time")
}

